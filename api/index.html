<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API - Swiss Similarities</title>
  

  <link rel="shortcut icon" href="../logo.png">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../daplab.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "API";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Swiss Similarities</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting_started/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">API</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#submit-a-job">Submit a job</a></li>
                
            
                <li class="toctree-l3"><a href="#retrieve-the-results">Retrieve the results</a></li>
                
                    <li><a class="toctree-l4" href="#processing-not-completed">Processing not completed</a></li>
                
                    <li><a class="toctree-l4" href="#processing-completed">Processing completed</a></li>
                
                    <li><a class="toctree-l4" href="#result-ttl">Result TTL</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../architecture/">Architecture</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Swiss Similarities</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>API</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>This page details the API accepting requests for the SwissSimilarities database.</p>
<p>As the search process might take some time, the search is asynchronous and then split in two parts: </p>
<ol>
<li>Submitting a search request via a POST call,</li>
<li>Polling to retrieve the results via a GET</li>
</ol>
<p>The following flow diagram shows a typical interaction with the server: the request is submitted first, the server
returns a HTTP status code <code>201 Created</code> along with a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>
referencing the request ID, which has be be used in all the subsequent API calls. 
The user will the start polling the server. HTTP status code <code>202 Accepted</code> is returned by the server until
the request is complet. Then a <code>200 OK</code> is used.</p>
<p><img alt="API Flow Chart" src="../api-flow-chart.png" /></p>
<p>The next section details the API, including the parameters exchanged with the server.</p>
<h1 id="submit-a-job">Submit a job</h1>
<pre><code>POST /api/v1/submit
</code></pre>

<p>The payload of the POST is JSON encoded, containing the attributes shown in the table below:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Mandatory</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>fingerprint</td>
<td>String</td>
<td>yes</td>
<td>hex encoded, 128 bytes molecule fingerprint. See the example below</td>
</tr>
<tr>
<td>limit</td>
<td>Number</td>
<td>no</td>
<td>number of matches to return, default 400, max 1000</td>
</tr>
<tr>
<td>threshold</td>
<td>Number</td>
<td>no</td>
<td>smiliarity threshold. Molecules below this threshold will not be returned, even if in the limit. Default 0.8, min 0.5</td>
</tr>
</tbody>
</table>
<p>An example of payload would be: </p>
<pre><code>{ 
   &quot;fingerprint&quot;: &quot;hex encoded, 128 bytes molecule fingerprint&quot;
   &quot;limit&quot;: 400
   &quot;threshold&quot;: 0.8
}
</code></pre>

<p>If the request is properly formatted, the server returns a HTTP status <code>201 Created</code>. The header will also contains
the location at which the job can be polled, as well as a JSON object containting the requestId:</p>
<pre><code>Location: /api/v1/result/$REQUEST_UUID

{
   &quot;requestId&quot;: &quot;$REQUEST_UUID&quot;
}
</code></pre>

<p>For instance</p>
<pre><code>POST /api/v1/submit

{ 
   &quot;fingerprint&quot;: &quot;hex encoded, 128 bytes molecule fingerprint&quot;
   &quot;retrieve&quot;: 400
   &quot;threshold&quot;: 0.8
}

Returns 201 Created
...
Location: /api/v1/result/$REQUEST_UUID
{
   &quot;uuid&quot;: &quot;$REQUEST_UUID&quot;
}
</code></pre>

<p>Malformatted requests, as well as requests missing the mandatory parameter(s) 
will return a HTTP status <code>400 Bad Request</code>.</p>
<h1 id="retrieve-the-results">Retrieve the results</h1>
<p>Retrieving the results might be composed of several calls. As long as the result is not ready, the call returns
a HTTP status <code>202 Accepted</code>. Once the result is ready, <code>200 OK</code> is returned along with the result itself
JSON encoded. The result is an array (sorted sequence) of molecules matching the request,
sorted by top similarity descendant. The exact format of the result is detailled below.</p>
<h2 id="processing-not-completed">Processing not completed</h2>
<pre><code>GET /api/v1/result/$requestId

202 Accepted
</code></pre>

<h2 id="processing-completed">Processing completed</h2>
<pre><code>GET /api/v1/result/$requestId

20O OK

[ 
  {
    &quot;fingerprint&quot;: &quot;...&quot;,
    &quot;smile&quot;: &quot;...&quot;
    &quot;similarity&quot;: 0.9999,
    &quot;details&quot;: {
      &quot;name&quot;: ...
    }
  },
  {
    ...
  },
  ...
]     
</code></pre>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Mandatory</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>fingerprint</td>
<td>String</td>
<td>yes</td>
<td></td>
</tr>
<tr>
<td>smile</td>
<td>String</td>
<td>yes</td>
<td></td>
</tr>
<tr>
<td>similarity</td>
<td>Number</td>
<td>yes</td>
<td></td>
</tr>
<tr>
<td>details</td>
<td>Object</td>
<td>yes</td>
<td></td>
</tr>
<tr>
<td>details.name</td>
<td>String</td>
<td>yes</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="result-ttl">Result TTL</h2>
<p>The result is kept 4 hours before it is discarded. If you're not retrieving the data during this time laps, 
the data is lost.</p>
<p>Subsequent retrieve call will consistently return <code>404 Not Found</code>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../architecture/" class="btn btn-neutral float-right" title="Architecture"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../getting_started/" class="btn btn-neutral" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../getting_started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../architecture/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
